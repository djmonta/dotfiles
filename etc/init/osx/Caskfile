#/bin/bash

trap 'echo Error: $0: stopped' ERR INT
set -u
set -e

if ! type brew >/dev/null 2>&1; then
    echo 'Requirement: brew' 1>&2
    exit 1
fi

#if ! brew cask >/dev/null 2>&1; then
if [[ ! "$(brew ls --versions brew-cask)" ]]; then
    echo 'brew-cask: command not found' 1>&2
    echo -n 'Install now? (y/N/) '
    read
    if [[ "$REPLY" =~ ^[Yy]$ ]]; then
        brew install caskroom/cask/brew-cask
    else
        exit 0
    fi
fi

#cask install alfred
#cask alfred  link

brew tap caskroom/versions
brew tap djmonta/cask

# Hack to show the first-run brew-cask password prompt immediately.
#brew cask info this-is-somewhat-annoying 2>/dev/null

declare -a CASK_PACKAGES=(
  # Applications
  "1password"
  "1piece"
  "airserver"
  "alfred"
  "appcleaner"
  "appstorehelper"
  "bartender"
  #"bittorrent-sync"
  "bowtie"
  "codekit"
  "dash"
  #"drobo-dashboard"
  "dropbox"
  "easysimbl"
  "flip4mac"
  "github"
  "google-chrome"
  #"google-drive"
  "handbrake"
  "ibackup"
  "iexplorer"
  #"ifunbox"
  "imageup"
  #"inboard"
  "itsycal"
  "karabiner"
  "kindle"
  "lastfm"
  "macdown"
  "mactubes"
  #"nvalt"
  #"owncloud"
  "parallels-desktop"
  #"picasa"
  "plex-home-theater"
  "plex-media-server"
  "sequel-pro"
  "simplecap"
  "subler"
  "sublime-text3"
  "things"
  "tower"
  "transmission"
  "transmit"
  "traumbaum"
  "vagrant"
  "vlc"
  #"xquartz"
  # PreferencePane
  "maddthesane-perian"
  # QuickLook plugins
  "qlcolorcode"
  "qlimagesize"
  "qlmarkdown"
  "qlstephen"
  "qlvideo"
  "suspicious-package"
)

for package in "${CASK_PACKAGES[@]}"
do
    if brew cask list -1 | grep -q "^${package}"; then
        echo "Skip: brew cask install ${package}"
    else
        brew cask install $package
    fi
done
brew cask cleanup
