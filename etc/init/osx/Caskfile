#/bin/bash

trap 'echo Error: $0: stopped' ERR INT
set -u
set -e

if ! type brew >/dev/null 2>&1; then
    echo 'Requirement: brew' 1>&2
    exit 1
fi

#if ! brew cask >/dev/null 2>&1; then
if [[ ! "$(brew ls --versions brew-cask)" ]]; then
    echo 'brew-cask: command not found' 1>&2
    echo -n 'Install now? (y/N/) '
    read
    if [[ "$REPLY" =~ ^[Yy]$ ]]; then
        brew install caskroom/cask/brew-cask
    else
        exit 0
    fi
fi

#cask install alfred
#cask alfred  link

declare -a TAPS=(
    'caskroom/versions'
    'caskroom/fonts'
    'djmonta/cask'
)

for TAP in "${TAPS[@]}"
do
    if brew tap | grep -q "^${TAP}"; then
        echo "Skip: brew tap ${TAP}"
    else
        brew tap $TAP
    fi
done

# Hack to show the first-run brew-cask password prompt immediately.
#brew cask info this-is-somewhat-annoying 2>/dev/null

declare -a CASK_PACKAGES=(
  # Applications
  "1password"
  #"1piece"
  "alfred"
  "appcleaner"
  "bartender"
  "bookmacster"
  "bowtie"
  "codekit"
  "dash"
  "dropbox"
  #"easysimbl"
  "font-fontawesome"
  "font-source-han-code-jp"
  "flip4mac"
  "github-desktop"
  "google-chrome"
  "handbrake"
  "ibackup"
  "iexplorer"
  "imageup"
  "itsycal"
  "karabiner"
  "kindle"
  "parallels-desktop"
  "sequel-pro"
  "simplecap"
  "subler"
  "sublime-text3"
  "tower"
  "transmission"
  "transmit"
  "traumbaum"
  "vagrant"
  "vlc"
  # PreferencePane
  #"maddthesane-perian"
  # QuickLook plugins
  "qlcolorcode"
  "qlimagesize"
  "qlmarkdown"
  "qlstephen"
  "qlvideo"
  #"suspicious-package"
)

for package in "${CASK_PACKAGES[@]}"
do
    if brew cask list -1 | grep -q "^${package}"; then
        echo "Skip: brew cask install ${package}"
    else
        brew cask install $package
    fi
done
brew cask cleanup
